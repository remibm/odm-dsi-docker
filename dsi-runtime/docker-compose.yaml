version: '3'

services:
        dsi-runtime:
                image: $DSI_IMAGE
                hostname: dsi-runtime
                domainname: dsi
                ports:
                        - "${HTTP_PORT}:9080"
                        - "${HTTPS_PORT}:9443"
                command: ["/root/start.sh", $DSI_TEMPLATE]
                environment:
                        - HTTP_PORT
                        - HTTPS_PORT
                        - LOGGING_TRACE_SPECIFICATION
                        - DSI_IMAGE
                        - DSI_TEMPLATE
                        - DSI_USER
                        - DSI_PASSWORD
                        - DSI_PARTITIONS_COUNT
                        - MAX_SYNC_REPLICAS
                        - MAX_ASYNC_REPLICAS
                        - DSI_DATABASE
                        - DSI_DB_HOSTNAME
                        - DSI_DB_PORT
                        - DSI_DB_NAME
                        - DSI_DB_SCHEMA
                        - DSI_DB_USER
                        - DSI_DB_PASSWORD
                        - DSI_JDBC_DIR
                        - DSI_DB_MAXPOOLSIZE
                        - DSI_DB_DELETEBATCHSIZE
                        - DSI_DB_DELETEPAUSEINTERVAL
                        - DSI_DB_MAXBATCHSIZE
                        - DSI_DB_MAXCACHEAGE
                volumes:
                        - volume-templates:/opt/dsi/runtime/wlp/templates/servers
                        - volume-solutions:/opt/dsi/runtime/wlp
                        - ${DSI_JDBC_DIR}:/jdbc:ro

volumes:
        volume-templates:
        volume-solutions:
